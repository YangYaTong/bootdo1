<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>欢迎页</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- App favicon -->
        <link rel="shortcut icon" href="assets/images/favicon.ico">
   

        <!-- date range picker -->
        <link href="../plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

        <!-- App css -->
        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/core.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/components.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/icons.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/pages.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/menu.css" rel="stylesheet" type="text/css" />
        <link href="/assets/css/responsive.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="../plugins/switchery/switchery.min.css">

        <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

     <!--    <script src="assets/js/modernizr.min.js"></script> -->
</head>
<body>
 <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
   
                    <div class="container">


                        <div class="row">
							 <div class="col-xs-12">
								<div class="page-title-box">
                                    <h4 class="page-title">欢迎你 </h4>
                                    
                                    <div class="clearfix"></div>
                                </div>
							</div> 
						</div>
					                        <!-- end row -->
					 <div class="row text-center">

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年合同数量</p>
                                        <h2 class="text-danger"><span data-plugin="counterup" th:text="*{map.myContractNumOfThisYear}"></span></h2>
                              
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年【收入型合同】总金额</p>
                                        <h2 class="text-dark"><span data-plugin="counterup" th:text="*{map.myIncomeContract}"></span> </h2>
                                       <!--  <p class="text-muted m-0"><b>本月:</b> 1250</p> -->
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年【支出型合同】总金额</p>
                                        <h2 class="text-success"><span data-plugin="counterup" th:text="*{map.myOutcomeContract}">52</span></h2>
                                       <!--  <p class="text-muted m-0"><b>本月:</b> 40.33k</p> -->
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年需支付金额</p>
                                        <h2 class="text-warning"><span data-plugin="counterup" th:text="*{map.myNeedOutcomeThisYear}">652</span> </h2>
                                       <!--  <p class="text-muted m-0"><b>本月:</b> 956</p> -->
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年待收入金额</p>
                                        <h2 class="text-primary"><span data-plugin="counterup" th:text="*{map.myNeedIncomeThisYear}">3245</span> </h2>
                                       <!--  <p class="text-muted m-0"><b>本月:</b> 20k</p> -->
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-2 col-md-4 col-sm-6">
                                <div class="card-box widget-box-one">
                                    <div class="wigdet-one-content">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow">全年异常合同数量</p>
                                        <h2 class="text-danger"><span data-plugin="counterup" th:text="*{map.abNormalContract}">1</span> </h2>
                                       <!--  <p class="text-muted m-0"><b>本月:</b> 0</p> -->
                                    </div>
                                </div>
                            </div><!-- end col -->

                        </div>
                        <!-- end row -->

                        <div class="row">

                            <div class="col-lg-3 col-md-6">
                                <div class="card-box widget-box-two widget-two-info">
                                   <!--  <i class="mdi mdi-chart-areaspline widget-two-icon"></i> -->
                                    <div class="wigdet-two-content text-white">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Statistics">本部门全年【支出型合同】总金额：</p>
                                        <h2 class="text-white"><span data-plugin="counterup" th:text="*{map.ourDepartmentOutcomeContract}">34578</span> <small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
                                         <p class="m-0"><b>年度预算剩余：</b> 30.4k</p> 
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-3 col-md-6">
                                <div class="card-box widget-box-two widget-two-primary">
                                  <!--   <i class="mdi mdi-layers widget-two-icon"></i> -->
                                    <div class="wigdet-two-content text-white">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="User This Month">本部门全年【收入型合同】总金额：</p>
                                        <h2 class="text-white"><span data-plugin="counterup" th:text="*{map.ourDepartmentIncomeContract}">52410 </span> <small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
										<p class="m-0"><b>年度预算剩余：</b> 30.4k</p> 
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-3 col-md-6">
                                <div class="card-box widget-box-two widget-two-danger">
                                   <!--  <i class="mdi mdi-access-point-network widget-two-icon"></i> -->
                                    <div class="wigdet-two-content text-white">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="Statistics">本部门全年待支付金额：</p>
                                        <h2 class="text-white"><span data-plugin="counterup" th:text="*{map.ourDepartmentNeedOutcomeThisYear}">6352</span> <small><i class="mdi mdi-arrow-up text-success"></i></small></h2>
                                    <p class="m-0"><b>已支付：</b>  <span  th:text="*{map.ourDepartmentActualOutcomeThisYear}"></span></p> 
                                    </div>
                                </div>
                            </div><!-- end col -->

                            <div class="col-lg-3 col-md-6">
                                <div class="card-box widget-box-two widget-two-success">
                                   <!--  <i class="mdi mdi-account-convert widget-two-icon"></i> -->
                                    <div class="wigdet-two-content text-white">
                                        <p class="m-0 text-uppercase font-600 font-secondary text-overflow" title="User Today">本部门全年待收入金额：</p>
                                        <h2 class="text-white"><span data-plugin="counterup" th:text="*{map.ourDepartmentNeedIncomeThisYear}">895 </span> <small><i class="mdi mdi-arrow-down text-danger"></i></small></h2>
                                     <p class="m-0"><b>已收入：</b> <span  th:text="*{map.ourDepartmentActualIncomeThisYear}"></span></p> 
                                    </div>
                                </div>
                            </div><!-- end col -->

                        </div>
                        <!-- end row -->


                                                    <div class="row">
                            <div class="col-lg-6">
                                <div class="card-box">
                                    <h4 class="header-title m-t-0 m-b-30">全年计划收支款</h4>

                                    <div id="dom_3" style="height: 320px;" class="flot-chart"></div>
                                </div>
                            </div>

                            <div class="col-lg-6">
                                <div class="card-box">
                                    <h4 class="header-title m-t-0 m-b-30">合同按类型占比</h4>

                                    <div id="dom_4" style="height: 320px;" class="flot-chart"></div>
                                </div>
                            </div>
                            </div> 

                      
                        <!-- end row -->


                        <div class="row">

                            <div class="col-md-4" >
                                <div class="panel panel-color panel-info">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">我的计划提醒</h3>
                                    </div>
                                    <div class="panel-body" >
                                        <div class="inbox-widget slimscroll-alt" style="min-height: 327px;"  id="remind_body">
                                            <!-- <a href="#">
                                                <div class="inbox-item">
                                                   <p>cccc</p>
                                                    <p class="inbox-item-author">Chadengle</p>
                                                    <p class="inbox-item-text">Hey! there I'm available...</p>
                                                    <p class="inbox-item-date">13:40 PM</p>
                                                </div>
                                            </a>
                                       -->
                                           
                                      
                                     
                                    </div>
                                </div>
                                <!-- end panel -->

                            </div>
                            </div>
                            <!-- end col -->

                            <div class="col-md-8" >
                                <div class="panel panel-color panel-info">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">我的待办事项</h3>
                                    </div>
                                    <div class="panel-body">
                                        <div class="table-responsive"  style="min-height: 327px;">
                                            <table class="table table table-hover m-0">
                                                <thead>
                                                    <tr>
                                            
                                                        <th>名称</th>
                                                        <th>发送人</th>
                                                        <th>发送时间</th>
                                                        <th>状态</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="todo_body">
                                       
                                                <!--  <tr >
                                                        
                                                        <td>
                                                            <h5 class="m-0">付款申请</h5>
                                                            
                                                        </td>
                                                        <td>张无忌</td>
                                                        <td>07/08/2016</td>
                                                        <td>未读</td>
                                                    </tr> -->

                                                </tbody>
                                            </table>

                                        </div> <!-- table-responsive -->
                                    </div> <!-- end panel body -->
                                </div>
                                <!-- end panel -->
                            </div>
                            <!-- end col -->

                        </div>
                        <!-- end row -->


                    </div> <!-- container -->

             <!--    </div> --> <!-- content -->

               

           <!--  </div> -->


            <!-- ============================================================== -->
            <!-- End Right content here -->
            <!-- ============================================================== -->

</body>
<script src="/js/jquery.min.js"></script>
<!-- <script src="js/openTab.js"></script> -->
<script src="/js/plugins/echarts/echarts-all.js"></script>
<script src="/js/main.js"></script>

<script th:inline="javascript">

var remindList=[[${map.remindList}]];
var todotableList=[[${map.todotableList}]];

var mapBar = [[${map.mapBar}]];
var mapPie = [[${map.mapPie}]];
/* var psLineChar = echarts.init(document.getElementById('website-stats')); 
var psLineChar2 = echarts.init(document.getElementById('website-stats-pie'));   */

function todo(id){
	location.href="/todoTable/todotable/pishi/"+id
}


//查询  
 
//载入图表  
//loadDrugs();  



if(remindList.length!=0){

	var html="";
	for(var i=0;i<remindList.length;i++){
		var type="";
		if(remindList[i].remark=="matter"){
			type="合同计划提醒";
		}else if(remindList[i].remark=="contract"){
			type="合同到期提醒";
		}
		
		
		html+=   '<a href="/contractRemind/remind/toSee/'+remindList[i].remindId+'"> <div class="inbox-item">'
        +'<p>'+type+'</p>'
        +'<p class="inbox-item-author">'+remindList[i].remindName+'</p>'
        +'<p class="inbox-item-date">'+remindList[i].remindDate+'</p></div></a>';
	}
	
	$("#remind_body").append(html);
	
	
	
	
	
}

if(todotableList.length!=0){

	var html="";
	for(var i=0;i<todotableList.length;i++){
		html+=' <tr onclick="todo('+todotableList[i].todotableId+')"><td>'
			+'<h5 class="m-0">'+todotableList[i].todotableName+'</h5></td>'
            +'<td>'+todotableList[i].sendUser+'</td>'
            +'<td>'+todotableList[i].sendTime+'</td>'
            +'<td>'+todotableList[i].state+'</td>'
            +'</tr>';
	}
	$("#todo_body").append(html);
	
}




</script>

<!-- 第3张柱状图 -->
<script type="text/javascript">
		// 基于准备好的dom，初始化echarts实例
		var myChart = echarts.init(document.getElementById('dom_3'));
		var myChart2 = echarts.init(document.getElementById('dom_4'));
			// 2.获取数据

			planOut=mapBar.dataPlanOut;
			planIn=mapBar.dataPlanIn;
 		var months = mapBar.months;
 		
 		var dataName = [];
 		var pieData = [];

 		for(var key in mapPie){ 
 			//console.log("key:"+key+";value:"+mapPie[key]);//经我考证，the key is undefined.So the method is not right. 
 			dataName.push(key);
 			
 			console.log(dataName);
 			
 			 var map ={};
             map.name = key;
             map.value = mapPie[key];
             pieData.push(map);
	
 		} 

			// 3.更新图表myChart的数据
			var option = {
				title : {
					text : '1-12月份计划收入\支出金额'
				},
				tooltip : {},
				legend : {
					data : [ '计划支出' ,'计划收入']
					
				},
				xAxis : {
					data : months
				},
				yAxis : {},
				series : [ {
					name : '计划支出',
					type : 'bar',
					data : planOut
				}, {
					name : '计划收入',
					type : 'bar',
					data : planIn
				} ],
				toolbox : {
					show : true,
					feature : {
						mark : {
							show : true
						},
						dataView : {
							show : true,
							readOnly : false
						},
						magicType : {
							show : true,
							type : [ 'line', 'bar' ]
						},
						restore : {
							show : true
						},
						saveAsImage : {
							show : true
						}
					}
				},
			}
			myChart.setOption(option);
			
			var option2  = {
				    tooltip: {
				        trigger: 'item',
				        formatter: "{a} <br/>{b}: {c} ({d}%)"
				    },
				    legend: {
				        orient: 'vertical',
				        x: 'left',
				        data:dataName
				    },
				    toolbox: {
				        show : true,
				        feature : {
				            mark : {show: true},
				            dataView : {show: true, readOnly: false},
				            magicType : {
				                show: true, 
				                type: ['pie', 'funnel'],
				                option: {
				                    funnel: {
				                        x: '5%',
				                        width: '0.5%',
				                        funnelAlign: 'left',
				                        max: 1548
				                    }
				                }
				            },
				            restore : {show: true},
				            saveAsImage : {show: true}
				        }
				    },
				    calculable : true,
				    series: [
				        {
				            name:'合同类型占比',
				            type:'pie',
				            radius: ['50%', '70%'],
				              /*    radius : '55%',
            					center: ['50%', '60%'], */
				     /*        avoidLabelOverlap: false,
				            label: {
				                normal: {
				                    show: false,
				                    position: 'center'
				                },
				                emphasis: {
				                    show: true,
				                    textStyle: {
				                        fontSize: '30',
				                        fontWeight: 'bold'
				                    }
				                }
				            },
				            labelLine: {
				                normal: {
				                    show: false
				                }
				            }, */
				            itemStyle : {
				                normal : {
				                    label : {
				                        show : false
				                    },
				                    labelLine : {
				                        show : false
				                    }
				                },
				                emphasis : {
				                    label : {
				                        show : true,
				                        position : 'center',
				                        textStyle : {
				                            fontSize : '30',
				                            fontWeight : 'bold'
				                        }
				                    }
				                }
				            },
				        
				            data:pieData
				        }
				    ]
				};
			
			
			
			/* 
			
			
			option = {
    tooltip : {
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c} ({d}%)"
    },
    legend: {
        orient : 'vertical',
        x : 'left',
        data:['直接访问','邮件营销','联盟广告','视频广告','搜索引擎']
    },
    toolbox: {
        show : true,
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            magicType : {
                show: true, 
                type: ['pie', 'funnel'],
                option: {
                    funnel: {
                        x: '25%',
                        width: '50%',
                        funnelAlign: 'center',
                        max: 1548
                    }
                }
            },
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    calculable : true,
    series : [
        {
            name:'访问来源',
            type:'pie',
            radius : ['50%', '70%'],
            itemStyle : {
                normal : {
                    label : {
                        show : false
                    },
                    labelLine : {
                        show : false
                    }
                },
                emphasis : {
                    label : {
                        show : true,
                        position : 'center',
                        textStyle : {
                            fontSize : '30',
                            fontWeight : 'bold'
                        }
                    }
                }
            },
            data:[
                {value:335, name:'直接访问'},
                {value:310, name:'邮件营销'},
                {value:234, name:'联盟广告'},
                {value:135, name:'视频广告'},
                {value:1548, name:'搜索引擎'}
            ]
        }
    ]
};
                    
			
			*/
			


			myChart2.setOption(option2);
			myChart2.on('click', function (params) {
			   //alert(params.name);
			  	var index = params.dataIndex;
			  	alert(index)
			});
	
			
			
			
		/* }) */
	</script>








</html>